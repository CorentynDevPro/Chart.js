<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Advanced Gantt Chart JS</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            font-family: sans-serif;
        }

        .chartCard {
            width: 100vw;
            height: 100%;
            background: rgba(54, 162, 235, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chartBox {
            width: 65%;
            height: 100%;
            margin-top: auto;
            padding: 20px;
            border-radius: 20px;
            border: solid 3px rgba(54, 162, 235, 1);
            background: white;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"
          integrity="sha512-5A8nwdMOWrSz20fDsjczgUidUBR8liPYU+WymTZP1lmY9G6Oc7HlZv156XqnsgNUzTyMefFTcsFH/tnJE/+xBg=="
          crossorigin="anonymous" referrerpolicy="no-referrer"/>
</head>
<body>
</div>
<div class="chartCard">
    <div class="chartBox">
        <canvas id="myChart"></canvas>
        <input type="month" onchange="chartFilter(this)"/>
        <br/>
        <br/>
        <hr/>
        <br/>
        <input type="text" id="nameTask" list="tasks"/>
        <datalist id="tasks">
        </datalist>

        <input type="date" id="startDateTask"/>
        <input type="date" id="endDateTask"/>
        <input type="text" id="teamMemberTask" list="names"/>
        <datalist id="names">
        </datalist>

        <select type="text" id="statusTask">
            <option value="0">Delayed</option>
            <option value="1">Pending</option>
            <option value="2">Completed</option>
        </select>
        <button onclick="addTask()">Create task</button>

        <br/>
        <br/>
        <hr/>
        <br/>

        <select id="minTask" onchange="showTask()">
            <option selected value="0">Task 1</option>
            <option value="1">Task 2</option>
            <option value="2">Task 3</option>
            <option value="3">Task 4</option>
        </select>

        <select id="maxTask" onchange="showTask()">
            <option value="5">Task 6</option>
            <option value="6">Task 7</option>
            <option value="7">Task 8</option>
            <option selected value="8">Task 9</option>
        </select>

    </div>
</div>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/chart.js/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>

<script>
    const colours = ['rgba(255, 26, 104, 1)', 'rgba(255, 159, 64, 1)', 'rgba(75, 192, 192, 1)'];
    // setup
    const data = {
        //labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
        datasets: [{
            label: 'Dates',
            data: [
                {
                    x: ['2025-05-03', '2025-05-06'],
                    y: 'Task 1',
                    name: 'James',
                    status: 2
                },
                {
                    x: ['2025-05-06', '2025-05-12'],
                    y: 'Task 2',
                    name: 'Luna',
                    status: 2
                },
                {
                    x: ['2025-05-09', '2025-05-12'],
                    y: 'Task 3',
                    name: 'David',
                    status: 2
                },
                {
                    x: ['2025-05-12', '2025-05-21'],
                    y: 'Task 4',
                    name: 'Lily',
                    status: 2
                },
                {
                    x: ['2025-05-15', '2025-05-24'],
                    y: 'Task 5',
                    name: 'Santiago',
                    status: 0
                },
                {
                    x: ['2025-05-18', '2025-05-30'],
                    y: 'Task 6',
                    name: 'James',
                    status: 1
                },
                {
                    x: ['2025-06-12', '2025-06-21'],
                    y: 'Task 7',
                    name: 'Lily',
                    status: 2
                },
                {
                    x: ['2025-06-15', '2025-06-24'],
                    y: 'Task 8',
                    name: 'Santiago',
                    status: 0
                },
                {
                    x: ['2025-06-18', '2025-06-30'],
                    y: 'Task 9',
                    name: 'James',
                    status: 1
                },
            ],
            backgroundColor: (ctx) => {
                return colours[ctx.raw.status];
            },
            borderSkipped: false,
            borderRadius: 10,
            barPercentage: 0.6,
        }]
    };

    const labelsArray = data.datasets[0].data.map((dataPoint, index) => {
        return dataPoint.y;
    })

    const labelsArrayFilter = [...new Set(labelsArray)];

    // status plugin block
    const status = {
        id: 'status',
        afterDatasetsDraw(chart, args, pluginOptions) {
            const {ctx, data, options, chartArea: {top, bottom, left, right}, scales: {x, y}} = chart;

            const icons = ['\uf00d', '\uf110', '\uf00c'];
            const angle = Math.PI / 180;
            const paddingRight = options.layout.padding.right;

            ctx.save()
            ctx.font = 'bolder 12px FontAwesome';
            ctx.textBaseline = 'middle';
            ctx.textAlign = 'center';

            data.datasets[0].data.forEach((datapoint, index) => {
                if (y.getPixelForValue(index) > top && y.getPixelForValue(index) < bottom) {
                    ctx.beginPath();
                    ctx.fillStyle = colours[datapoint.status];
                    ctx.arc(right + (paddingRight / 2), y.getPixelForValue(index), 12, 0, angle * 360, false);
                    ctx.closePath();
                    ctx.fill();
                    ctx.fillStyle = 'white';

                    ctx.fillText(icons[datapoint.status], right + (paddingRight / 2), y.getPixelForValue(index))
                }
            })
            ctx.font = 'bolder 12px sans-serif';
            ctx.fillStyle = 'black';
            ctx.fillText('Status', right + (paddingRight / 2), top - 19)
            ctx.restore()
        }
    }

    // todayLine plugin block
    const todayLine = {
        id: 'todayLine',
        afterDatasetsDraw(chart, args, pluginOptions) {
            const {ctx, data, chartArea: {top, bottom, left, right}, scales: {x, y}} = chart;
            ctx.save();

            if (x.getPixelForValue(new Date()) >= left && x.getPixelForValue(new Date()) <= right) {
                ctx.beginPath();
                ctx.lineWidth = 3;
                ctx.strokeStyle = 'rgba(102, 102, 102, 1)';
                ctx.setLineDash([6, 6]);
                ctx.moveTo(x.getPixelForValue(new Date()), top);
                ctx.lineTo(x.getPixelForValue(new Date()), bottom);
                ctx.stroke();
                ctx.restore();

                ctx.setLineDash([]);

                // Draw the pointing down arrow
                ctx.beginPath();
                ctx.lineWidth = 1;
                ctx.strokeStyle = 'rgba(102, 102, 102, 1)';
                ctx.moveTo(x.getPixelForValue(new Date()), top + 1);
                ctx.lineTo(x.getPixelForValue(new Date()) - 4, top - 6);
                ctx.lineTo(x.getPixelForValue(new Date()) + 4, top - 6);
                ctx.closePath();
                ctx.fillStyle = 'rgba(102, 102, 102, 1)';
                ctx.stroke();
                ctx.fill();
                ctx.restore();

                // Text at the bottom dotted line
                ctx.font = 'bolder 12px sans-serif';
                ctx.fillStyle = 'rgba(102, 102, 102, 1)';
                ctx.textAlign = 'center';
                ctx.fillText('Today', x.getPixelForValue(new Date()), bottom + 13);
                ctx.restore();
            }
        }
    }

    // assignedTasks plugin block
    const assignedTasks = {
        id: 'assignedTasks',
        afterDatasetsDraw(chart, args, pluginOptions) {
            const {ctx, data, chartArea: {top, bottom, left, right}, scales: {x, y}} = chart;

            ctx.save();
            ctx.font = 'bolder 12px sans-serif';
            ctx.fillStyle = 'black';
            ctx.textAlign = 'left';

            data.datasets[0].data.forEach((datapoint, index) => {
                if (y.getPixelForValue(index) > top && y.getPixelForValue(index) < bottom) {
                    ctx.fillText(datapoint.name, 10, y.getPixelForValue(index))
                }
            })
            ctx.fillText('Names', 10, top - 15)
            ctx.restore()
        }
    }

    // weekend plugin block
    const weekend = {
        id: 'weekend',
        beforeDatasetsDraw(chart, args, pluginOptions) {
            const {ctx, chartArea: {top, bottom, left, right, width, height}, scales: {x, y}} = chart;

            ctx.save();

            x.ticks.forEach((tick, index) => {
                const day = new Date(tick.value).getDay();
                if (day === 6 || day === 0) {
                    ctx.fillStyle = pluginOptions.weekendColor;
                    ctx.fillRect(x.getPixelForValue(tick.value), top, x.getPixelForValue(new Date(tick.value).setHours(24)) - x.getPixelForValue(tick.value), height);
                }
            })
        }
    }

    // config
    const config = {
        type: 'bar',
        data,
        options: {
            layout: {
                padding: {
                    left: 100,
                    right: 100,
                    bottom: 20,
                }
            },
            indexAxis: 'y',
            scales: {
                x: {
                    position: 'top',
                    type: 'time',
                    time: {
                        //unit: 'day'
                        displayFormats: {
                            day: 'd',
                        }
                    },
                    min: '2025-05-01',
                    max: '2025-05-31',
                },
                y: {
                    min: 0,
                    max: 5,
                    labels: labelsArrayFilter
                }
            },
            plugins: {
                weekend: {
                    weekendColor: 'rgba(102, 102, 102, 0.2)',
                },
                legend: {
                    display: false
                },
                tooltip: {
                    displayColors: false,
                    yAlign: 'bottom',
                    callbacks: {
                        label: (ctx) => {
                            return '';
                        },
                        title: (ctx) => {
                            const startDate = new Date(ctx[0].raw.x[0])
                            const endDate = new Date(ctx[0].raw.x[1])
                            const assigneeName = ctx[0].raw.name;
                            const formattedStartDate = startDate.toLocaleDateString([], {
                                year: 'numeric',
                                month: 'short',
                                day: 'numeric',
                            });
                            const formattedEndDate = endDate.toLocaleDateString([], {
                                year: 'numeric',
                                month: 'short',
                                day: 'numeric',
                            });
                            return ['Task deadline: ' + formattedStartDate + ' - ' + formattedEndDate, 'Assignee: ' + assigneeName];
                        }
                    }
                }
            }
        },
        plugins: [
            todayLine,
            assignedTasks,
            status,
            weekend
        ]
    };

    // render init block
    const myChart = new Chart(
        document.getElementById('myChart'),
        config
    );

    function chartFilter(date) {
        const year = date.value.substring(0, 4);
        const month = date.value.substring(5, 7);
        const lastDay = (y, m) => {
            return new Date(y, m, 0).getDate();
        }

        const startDate = (`${year}-${month}-01`);
        const endDate = (`${year}-${month}-${lastDay(year, month)}`);

        myChart.config.options.scales.x.min = startDate;
        myChart.config.options.scales.x.max = endDate;
        myChart.update();
    }

    function addTask() {
        const nameTask = document.getElementById('nameTask');
        const startDateTask = document.getElementById('startDateTask');
        const endDateTask = document.getElementById('endDateTask');
        const teamMemberTask = document.getElementById('teamMemberTask');
        const statusTask = document.getElementById('statusTask');

        const arrayLength = myChart.data.datasets[0].data.length;
        myChart.data.datasets[0].data[arrayLength] = {
            x: [startDateTask.value, endDateTask.value],
            y: nameTask.value, name: teamMemberTask.value, status: parseInt(statusTask.value)
        };
        addNames();
        myChart.update();
    }

    function addNames() {
        const names = document.getElementById('names');
        while (names.firstElementChild) {
            names.removeChild(names.firstElementChild);
        }

        const namesArray = myChart.data.datasets[0].data.map((dataPoint) => {
            return dataPoint.name;
        })

        const namesArrayFiltered = [...new Set(namesArray)];

        namesArrayFiltered.forEach((memberName) => {
            const option = document.createElement('option');
            option.value = memberName;
            names.appendChild(option);
        })
    }

    addNames();

    function addTasks() {
        const tasks = document.getElementById('tasks');
        while (tasks.firstElementChild) {
            tasks.removeChild(tasks.firstElementChild);
        }

        labelsArrayFilter.forEach((taskItem) => {
            const option = document.createElement('option');
            option.value = taskItem;
            tasks.appendChild(option);
        })
    }

    addTasks();

    function showTask() {
        const yScale = myChart.config.options.scales.y;
        const minTask = document.getElementById('minTask').value;
        const maxTask = document.getElementById('maxTask').value;

        yScale.min = yScale.labels[minTask];
        yScale.max = yScale.labels[maxTask];

        myChart.update();
    }

    // Instantly assign Chart.js version
    const chartVersion = document.getElementById('chartVersion');
    chartVersion.innerText = Chart.version;
</script>

</body>
</html>